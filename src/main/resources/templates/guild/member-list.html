<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!-- 네비게이션 바 -->
<div th:replace="~{fragments/navbar :: navbar}"></div>
<head>
    <title>길드원 목록</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/guild-styles.css}">
</head>
<body>
<div class="board-wrapper">
    <h2 class="board-title">길드원 목록</h2>

    <div class="list-actions">
        <form th:action="@{/guild}" method="get" class="search-form">
            <input type="text" name="keyword" th:value="${keyword}" placeholder="검색어 입력...">
            <button type="submit">검색</button>
            <button type="button" class="reset-btn" onclick="resetSearch()">초기화</button>
        </form>

        <div class="button-group">
            <a href="/guild/export" class="add-btn">📥 엑셀 다운로드</a>
            <a href="/guild/discord-messages" class="add-btn">+ 메시지 분류</a>
            <a href="/guild/new" class="add-btn">+ 길드원 추가</a>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(members)}" class="empty-message">
        등록된 길드원이 없습니다.
    </div>

    <table class="board-table" th:unless="${#lists.isEmpty(members)}">
        <thead>
        <tr>
            <th>기사/본캐</th>
            <th>부기사/부캐</th>
            <th>배럭</th>
            <th style="width: 150px;">액션</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="member : ${members}">
            <td th:text="${member.name}"></td>
            <td th:text="${#strings.arrayJoin(member.subCharacterNames, ', ')}"></td>
            <td th:text="${#strings.arrayJoin(member.knightCharacterNames, ', ')}"></td>
            <td>
                <div class="action-buttons">
                    <a th:href="@{/guild/edit/{id}(id=${member.id})}" class="edit-btn">수정</a>
                    <form th:action="@{/guild/delete/{id}(id=${member.id})}" method="post" style="display:inline">
                        <button type="submit" class="delete-btn" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
                    </form>
                </div>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- 페이징 -->
    <div class="pagination" th:if="${totalPages > 1}">
        <a th:if="${currentPage > 0}"
           th:href="@{/guild(page=${currentPage - 1}, keyword=${keyword})}">이전</a>

        <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
        <a th:href="@{/guild(page=${i}, keyword=${keyword})}"
           th:text="${i + 1}"
           th:classappend="${i == currentPage} ? 'active' : ''"></a>
    </span>

        <a th:if="${currentPage < totalPages - 1}"
           th:href="@{/guild(page=${currentPage + 1}, keyword=${keyword})}">다음</a>
    </div>

</div>

<script>
    function resetSearch() {
        const form = document.querySelector('.search-form');
        form.keyword.value = '';  // 검색어 입력창 비우기
        form.submit();            // 폼 제출해서 리스트 초기 상태로
    }
</script>

</body>
</html>
